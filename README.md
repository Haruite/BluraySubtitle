# BluraySubtitle
本工具用于将分集的字幕合并成适合蓝光播放的字幕。  
因为原盘一般都是几集整一个盘，连续播放，主播放列表一般有2-6集不等。而字幕组制作的字幕基本上都是按单集划分，如果想用 PowerDVD 或者 JMC 看原盘的话就面临字幕不匹配的问题，解决方法只能是合并字幕，而这个操作手动做事很费时间的。所以我研究了这个问题，写了一个全自动合并字幕的脚本，只需要选择原盘所在的文件夹和字幕所在的文件夹，就能合成原盘播放所需的字幕。  
代码：https://github.com/Haruite/BluraySubtitle/blob/main/BluraySubtitle.py

#### 使用方法:
将代码保存为文件，python 运行。“原盘所在的文件夹”指的是原盘合集的根目录，字幕所在的文件是 .ass 文件的上级目录，注意检查 .ass 文件的顺序(这个顺序不是 Windows 资源管理器显示的顺序，而是按字符逐一比较的顺序)，.ass 文件要和原盘每集一一对应且顺序一致。  
(去 python 官网下载最新版安装，安装时把勾全选上，装完后打开 cmd 输入 pip install PyQt6，然后双击 .py 文件就可以运行)  
注意：此工具只适用于合并每集约 24min 或者更短每集的动漫，对于美剧没试过。

#### Feature:
1. 支持原盘为 iso 文件 (仅限 Windows 系统可用) 
2. 支持 .ass/.ssa/.srt 格式的字幕

#### TODO:
1. 测试更多原盘已验证修补其功能 
2. 提供让用户选择播放列表的功能

#### 目前测试成功的例子
1. U2#38573 (开始时间不在 m2ts 开头)
2. U2#26790 (一个 m2ts 两集)
3. U2#1309 (肉酱盘)
4. U2#53672 (SDBD，一卷 39 集)

#### 已知问题
1. 当字幕中存在一些结束时间特别靠后的行时(远远超出每集的结束时间)，生成的字幕会错乱，例如这个字幕（解决方法：修改或更换字幕）
2. 当特典内容比正片长而且有章节时，有概率选择特典的播放列表从而导致错误，目前发现有孤独摇滚的原盘第三卷和第六卷（解决方法：打开 PLAYLIST 文件夹，播放里面的 .mpls 文件，删除特典内容对应的 .mpls 文件，生成字幕后还原）
3. 当播放列表中除了正片还有其他内容时，合并的字幕可能时间轴不对，目前发现有奇巧出租车的原盘（解决方法：暂无，可能需要手动合并字幕）
4. 部分肉酱盘合成字幕错乱，目前发现有境界线上的地平线第一季和第二季（解决方法：暂无，等修复 TBD）

#### 特殊情况
1. 存在特典盘的时候，必须先把特典盘移除，生成字幕后再还原。
2. 有些原盘是一集一集播放的，这种情况不需要合并字幕，在 STREAM 文件夹找到对应的 m2ts 文件播放即可

20240714 注意，已修改脚本使其可以在 MPLS 目录下生成字幕文件，主要是为了方便 potplayer 播放，之前的脚本不会在 MPLS 目录下生成字幕，如果想要补上，可以使用AddSubToMPLS脚本  
20241018 添加新的功能，用原盘mpls文件给mkv文件加上章节  
使用方法如下：  
打开工具，选择“给mkv添加章节”  
下载原盘的 mpls 文件  
将原盘所在的文件夹拖到工具界面对应的位置  
再看 BDrip，根目录下除了 24 个主视频外还有 OP/ED 等，虽然再本例中并无影响，但还是建议将主视频单独移至一个文件夹，移动后将视频所在的文件夹也拖到工具界面对应的位置  
默认勾选直接编辑原文件，如果正在做种请注意，运行程序后将修改文件不能继续做种。如果不勾选，将会在output文件夹下生成新的文件。  
点击工具底部的添加章节，如果勾选编辑原文件将很快完成，如果不勾选则耐心等待混流完成。
